{"version":3,"sources":["src/d3.js","src/CalculateTree/CalculateTree.handlers.js","src/handlers/checkIfRelativesConnectedWithoutPerson.js","src/handlers/general.js","src/handlers/newPerson.js","src/CalculateTree/CalculateTree.js","src/view/View.handlers.js","src/view/elements/Link.js","src/view/elements/Card.Elements.js","src/AddRelativeTree/AddRelativeTree.CalculateTree.js","src/AddRelativeTree/AddRelativeTree.View.js","src/handlers/cardMethods.js","src/view/elements/Card.js","src/AddRelativeTree/AddRelativeTree.AddRelative.js","src/AddRelativeTree/AddRelativeTree.js","src/index.js","src/createStore.js","src/view/View.d3Animation.js","src/CalculateTree/createLinks.js","FamilyChart.js","App.js","index.js"],"names":["window","d3","_d3","otherParent","d","p1","data","find","d0","id","rels","mother","father","calculateEnterAndExitPositions","entering","exiting","depth","spouse","_x","x","_y","y","is_ancestry","parent","psx","toggleRels","tree_datum","hide_rels","rels_","showHideAncestry","rel_type","main","children","slice","spouses","forEach","sp","ch_id","includes","push","splice","indexOf","showHideChildren","toggleAllRels","tree_data","checkIfRelativesConnectedWithoutPerson","datum","data_stash","r","r_ids","filter","r_id","rels_not_to_main","i","without_persons","line","isM","checkIfAnyRelIsMain","history","runAllRels","f","d_id","findPersonLineToMain","length","moveToAddToAdded","to_add","removeToAdd","deletePerson","k","hasOwnProperty","Array","isArray","findIndex","did","createTreeDataWithMainNode","success","error","manualZoom","amount","svg","transition_time","zoom","__zoomObj","select","transition","duration","delay","call","scaleBy","isAllRelativeDisplayed","v","every","rel_id","some","generateUUID","Date","getTime","d2","performance","now","replace","c","Math","random","floor","toString","handleRelsOfNewDatum","rel_datum","addSpouse","spouse_id","removeIfToAdd","other_parent","new_spouse","createNewPersonWithGenderFromRel","addNewPerson","addOtherParent","gender","addChildToSpouseAndParentToChild","addChild","is_father","parent_to_add_id","handleSpouse","addParent","createNewPerson","getGenderFromRelative","Object","assign","version","addNewPersonAndHandleRels","CalculateTree","main_id","is_vertical","node_separation","level_separation","to_add_spouses","child","d1","createToAddSpouse","createRelsToAdd","sort","a","b","a_d","b_d","a_p2","b_p2","a_i","b_i","tree_children","calculateTreePositions","tree_parents","parents","mid_diff","levelOutEachSide","tree","setupChildrenAndParents","side","sp_id","added","sx","p2","midd","setupSpouses","d_x","nodePositioning","dim","w_extent","extent","h_extent","width","height","x_off","y_off","calculateTreeDim","rt","hierarchyGetter","map","d3_tree","nodeSize","separation","offset","sameParent","hasSpouses","someSpouses","max","offsetOnPartners","sameBothParents","root","hierarchy","descendants","positionTree","t","transform","zoomIdentity","scale","translate","treeFit","svg_dim","tree_dim","with_transition","min","calculateTreeFit","createPath","is_","curve","curveMonotoneY","lineCurve","curveBasis","path_data","_d","CardBody","card_dim","card_display","template","w","h","text_x","text_y","CardBodyAddNew","card_add","label","CardBodyOutline","is_new","PencilIcon","HideIcon","MiniTree","PlusIcon","LinkBreakIcon","closed","LinkBreakIconWrapper","g","_r","_rels","areParents","areChildren","sp_r","_sp_r","CardImage","image","maleIcon","femaleIcon","img_x","img_y","img_h","img_w","labels","lbls","fn","ln","son","daughter","View","store","cont","cardEditForm","getBoundingClientRect","tree_fit","s","Link","is_main","pos","color_class","Card","mounted","node","view","addEventListener","e","closest","getAttribute","new_datum","postSubmit","remove","update","handleCardClick","target","cardChangeMain","card","getTree","mainId","tree_position","cardEdit","props","getData","delete","cardShowHideRels","default_props","mini_tree","link_break","setupProps","querySelector","curvedRectPath","no_curve_corners","ncc","ncc_check","corner","lx","rx","ry","ly","insertAdjacentHTML","setupSvgDefs","el","document","createElementNS","gender_class","show_mini_tree","state","unknown_lbl","innerHTML","avatar","p","stopPropagation","addRelative","setupListeners","AddRelative","innerWidth","div_add_relative","createElement","style","cssText","appendChild","AddRelativeTree","createStore","initial_state","onUpdate","setOnUpdate","methods","d3AnimationView","svg_html","fake_cont","firstElementChild","createSvg","zoom_polite","__zoom","on","attr","type","ctrlKey","touches","setupZoom","setupSvg","selectAll","card_exit","exit","card_enter","enter","append","card_update","merge","CardElement","CardDefault","each","this","calculateDelay","updateCards","links_data","reduce","acc","concat","links","_or","join","getMid","linkId","handleAncestrySide","handleProgenySide","hy","args","createLinks","link","link_exit","link_enter","link_update","path","updateLinks","initial","mainToMiddle","ancestry_levels","setCard","handlers","elements","FamilyTree","React","createRef","current","f3","require","className","ref","Component","App","rootElement","getElementById","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.3000de43.chunk.js","sourcesContent":["import * as _d3 from 'd3';\nexport default typeof window === \"object\" && !!window.d3 ? window.d3 : _d3;","export function sortChildrenWithSpouses(data) {\n  data.forEach(datum => {\n    if (!datum.rels.children) return\n    datum.rels.children.sort((a, b) => {\n      const a_d = data.find(d => d.id === a),\n        b_d = data.find(d => d.id === b),\n        a_p2 = otherParent(a_d, datum, data) || {},\n        b_p2 = otherParent(b_d, datum, data) || {},\n        a_i = datum.rels.spouses.indexOf(a_p2.id),\n        b_i = datum.rels.spouses.indexOf(b_p2.id)\n\n      if (datum.data.gender === \"M\") return a_i - b_i\n      else return b_i - a_i\n    })\n  })\n}\n\nfunction otherParent(d, p1, data) {\n  return data.find(d0 => (d0.id !== p1.id) && ((d0.id === d.rels.mother) || (d0.id === d.rels.father)))\n}\n\nexport function calculateEnterAndExitPositions(d, entering, exiting) {\n  d.exiting = exiting\n  if (entering) {\n    if (d.depth === 0 && !d.spouse) {d._x = d.x; d._y = d.y}\n    else if (d.spouse) {d._x = d.spouse.x; d._y = d.spouse.y;}\n    else if (d.is_ancestry) {d._x = d.parent.x; d._y = d.parent.y;}\n    else {d._x = d.psx; d._y = d.parent.y;}\n  } else if (exiting) {\n    const x = d.x > 0 ? 1 : -1,\n      y = d.y > 0 ? 1 : -1\n    {d._x = d.x+400*x; d._y = d.y+400*y;}\n  }\n}\n\nexport function toggleRels(tree_datum, hide_rels) {\n  const\n    rels = hide_rels ? 'rels' : '_rels',\n    rels_ = hide_rels ? '_rels' : 'rels'\n  \n  if (tree_datum.is_ancestry || tree_datum.data.main) {showHideAncestry('father'); showHideAncestry('mother')}\n  else {showHideChildren()}\n\n  function showHideAncestry(rel_type) {\n    if (!tree_datum.data[rels] || !tree_datum.data[rels][rel_type]) return\n    if (!tree_datum.data[rels_]) tree_datum.data[rels_] = {}\n    tree_datum.data[rels_][rel_type] = tree_datum.data[rels][rel_type]\n    delete tree_datum.data[rels][rel_type]\n  }\n\n  function showHideChildren() {\n    if (!tree_datum.data[rels] || !tree_datum.data[rels].children) return\n    const\n      children = tree_datum.data[rels].children.slice(0),\n      spouses = tree_datum.spouse ? [tree_datum.spouse] : tree_datum.spouses || [];\n\n    [tree_datum, ...spouses].forEach(sp => children.forEach(ch_id => {\n      if (sp.data[rels].children.includes(ch_id)) {\n        if (!sp.data[rels_]) sp.data[rels_] = {}\n        if (!sp.data[rels_].children) sp.data[rels_].children = []\n        sp.data[rels_].children.push(ch_id)\n        sp.data[rels].children.splice(sp.data[rels].children.indexOf(ch_id), 1)\n      }\n    }))\n  }\n}\n\nexport function toggleAllRels(tree_data, hide_rels) {\n  tree_data.forEach(d => {d.data.hide_rels = hide_rels; toggleRels(d, hide_rels)})\n}\n\n","export function checkIfRelativesConnectedWithoutPerson(datum, data_stash) {\n  const r = datum.rels,\n    r_ids = [r.father, r.mother, ...(r.spouses || []), ...(r.children || [])].filter(r_id => !!r_id),\n    rels_not_to_main = [];\n\n  for (let i = 0; i < r_ids.length; i++) {\n    const line = findPersonLineToMain(data_stash.find(d => d.id === r_ids[i]), [datum])\n    if (!line) {rels_not_to_main.push(r_ids[i]); break;}\n  }\n  return rels_not_to_main.length === 0;\n\n  function findPersonLineToMain(datum, without_persons) {\n    let line;\n    if (isM(datum)) line = [datum]\n    checkIfAnyRelIsMain(datum, [datum])\n    return line\n\n    function checkIfAnyRelIsMain(d0, history) {\n      if (line) return\n      history = [...history, d0];\n      runAllRels(check);\n      if (!line) runAllRels(checkRels);\n\n      function runAllRels(f) {\n        const r = d0.rels;\n        [r.father, r.mother, ...(r.spouses || []), ...(r.children || [])]\n          .filter(d_id => (d_id && ![...without_persons, ...history].find(d => d.id === d_id)))\n          .forEach(d_id => f(d_id));\n      }\n\n      function check(d_id) {\n        if (isM(d_id)) line = history\n      }\n\n      function checkRels(d_id) {\n        const person = data_stash.find(d => d.id === d_id)\n        checkIfAnyRelIsMain(person, history)\n      }\n    }\n  }\n  function isM(d0) {return typeof d0 === 'object' ? d0.id === data_stash[0].id : d0 === data_stash[0].id}  // todo: make main more exact\n}","import d3 from \"../d3.js\"\nimport {checkIfRelativesConnectedWithoutPerson} from \"./checkIfRelativesConnectedWithoutPerson.js\"\nimport {createTreeDataWithMainNode} from \"./newPerson.js\"\n\nexport function moveToAddToAdded(datum, data_stash) {\n  delete datum.to_add\n  return datum\n}\n\nexport function removeToAdd(datum, data_stash) {\n  deletePerson(datum, data_stash)\n  return false\n}\n\nexport function deletePerson(datum, data_stash) {\n  if (!checkIfRelativesConnectedWithoutPerson(datum, data_stash)) return {success: false, error: 'checkIfRelativesConnectedWithoutPerson'}\n  executeDelete()\n  return {success: true};\n\n  function executeDelete() {\n    data_stash.forEach(d => {\n      for (let k in d.rels) {\n        if (!d.rels.hasOwnProperty(k)) continue\n        if (d.rels[k] === datum.id) {\n          delete d.rels[k]\n        } else if (Array.isArray(d.rels[k]) && d.rels[k].includes(datum.id)) {\n          d.rels[k].splice(d.rels[k].findIndex(did => did === datum.id), 1)\n        }\n      }\n    })\n    data_stash.splice(data_stash.findIndex(d => d.id === datum.id), 1)\n    data_stash.forEach(d => {if (d.to_add) deletePerson(d, data_stash)})  // full update of tree\n    if (data_stash.length === 0) data_stash.push(createTreeDataWithMainNode({}).data[0])\n  }\n}\n\nexport function manualZoom({amount, svg, transition_time=500}) {\n  const zoom = svg.__zoomObj\n  d3.select(svg).transition().duration(transition_time || 0).delay(transition_time ? 100 : 0)  // delay 100 because of weird error of undefined something in d3 zoom\n    .call(zoom.scaleBy, amount)\n}\n\nexport function isAllRelativeDisplayed(d, data) {\n  const r = d.data.rels,\n    all_rels = [r.father, r.mother, ...(r.spouses || []), ...(r.children || [])].filter(v => v)\n  return all_rels.every(rel_id => data.some(d => d.data.id === rel_id))\n}\n\nexport function generateUUID() {\n  var d = new Date().getTime();\n  var d2 = (performance && performance.now && (performance.now()*1000)) || 0;//Time in microseconds since page-load or 0 if unsupported\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16;\n    if(d > 0){//Use timestamp until depleted\n      r = (d + r)%16 | 0;\n      d = Math.floor(d/16);\n    } else {//Use microseconds since page-load if supported\n      r = (d2 + r)%16 | 0;\n      d2 = Math.floor(d2/16);\n    }\n    return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\n  });\n}\n","import {generateUUID, removeToAdd} from \"./general.js\";\n\nexport function handleRelsOfNewDatum({datum, data_stash, rel_type, rel_datum}) {\n  if (rel_type === \"daughter\" || rel_type === \"son\") addChild(datum)\n  else if (rel_type === \"father\" || rel_type === \"mother\") addParent(datum)\n  else if (rel_type === \"spouse\") addSpouse(datum)\n\n  function addChild(datum) {\n    if (datum.data.other_parent) {\n      addChildToSpouseAndParentToChild(datum.data.other_parent)\n      delete datum.data.other_parent\n    }\n    datum.rels[rel_datum.data.gender === 'M' ? 'father' : 'mother'] = rel_datum.id\n    if (!rel_datum.rels.children) rel_datum.rels.children = []\n    rel_datum.rels.children.push(datum.id)\n    return datum\n\n    function addChildToSpouseAndParentToChild(spouse_id) {\n      if (spouse_id === \"_new\") spouse_id = addOtherParent().id;\n\n      const spouse = data_stash.find(d => d.id === spouse_id)\n      datum.rels[spouse.data.gender === 'M' ? 'father' : 'mother'] = spouse.id\n      if (!spouse.rels.hasOwnProperty('children')) spouse.rels.children = []\n      spouse.rels.children.push(datum.id)\n\n      function addOtherParent() {\n        const new_spouse = createNewPersonWithGenderFromRel({rel_type: \"spouse\", rel_datum})\n        addSpouse(new_spouse)\n        addNewPerson({data_stash, datum: new_spouse})\n        return new_spouse\n      }\n    }\n  }\n\n  function addParent(datum) {\n    const is_father = datum.data.gender === \"M\",\n      parent_to_add_id = rel_datum.rels[is_father ? 'father' : 'mother'];\n    if (parent_to_add_id) removeToAdd(data_stash.find(d => d.id === parent_to_add_id), data_stash)\n    addNewParent()\n\n    function addNewParent() {\n      rel_datum.rels[is_father ? 'father' : 'mother'] = datum.id\n      handleSpouse()\n      datum.rels.children = [rel_datum.id]\n      return datum\n\n      function handleSpouse() {\n        const spouse_id = rel_datum.rels[!is_father ? 'father' : 'mother']\n        if (!spouse_id) return\n        const spouse = data_stash.find(d => d.id === spouse_id)\n        datum.rels.spouses = [spouse_id]\n        if (!spouse.rels.spouses) spouse.rels.spouses = []\n        spouse.rels.spouses.push(datum.id)\n        return spouse\n      }\n    }\n  }\n\n  function addSpouse(datum) {\n    removeIfToAdd();\n    if (!rel_datum.rels.spouses) rel_datum.rels.spouses = []\n    rel_datum.rels.spouses.push(datum.id);\n    datum.rels.spouses = [rel_datum.id];\n\n    function removeIfToAdd() {\n      if (!rel_datum.rels.spouses) return\n      rel_datum.rels.spouses.forEach(spouse_id => {\n        const spouse = data_stash.find(d => d.id === spouse_id);\n        if (spouse.to_add) removeToAdd(spouse, data_stash)\n      })\n    }\n  }\n}\n\nexport function createNewPerson({data, rels}) {\n  return {id: generateUUID(), data: data || {}, rels: rels || {}}\n}\n\nexport function createNewPersonWithGenderFromRel({data, rel_type, rel_datum}) {\n  const gender = getGenderFromRelative(rel_datum, rel_type)\n  data = Object.assign(data || {}, {gender})\n  return createNewPerson({data})\n\n  function getGenderFromRelative(rel_datum, rel_type) {\n    return ([\"daughter\", \"mother\"].includes(rel_type) || rel_type === \"spouse\" && rel_datum.data.gender === \"M\") ? \"F\" : \"M\"\n  }\n}\n\nexport function addNewPerson({data_stash, datum}) {\n  data_stash.push(datum)\n}\n\nexport function createTreeDataWithMainNode({data, version}) {\n  return {data: [createNewPerson({data})], version}\n}\n\nexport function addNewPersonAndHandleRels({datum, data_stash, rel_type, rel_datum}) {\n  addNewPerson({data_stash, datum})\n  handleRelsOfNewDatum({datum, data_stash, rel_type, rel_datum})\n}\n","import d3 from \"../d3.js\"\nimport {sortChildrenWithSpouses} from \"./CalculateTree.handlers.js\"\nimport {createNewPerson} from \"../handlers/newPerson.js\"\n\nexport default function CalculateTree({data_stash, main_id=null, is_vertical=true, node_separation=250, level_separation=150}) {\n  data_stash = createRelsToAdd(data_stash)\n  sortChildrenWithSpouses(data_stash)\n  const main = main_id !== null ? data_stash.find(d => d.id === main_id) : data_stash[0],\n    tree_children = calculateTreePositions(main, 'children', false),\n    tree_parents = calculateTreePositions(main, 'parents', true)\n\n  data_stash.forEach(d => d.main = d === main)\n  levelOutEachSide(tree_parents, tree_children)\n  const tree = mergeSides(tree_parents, tree_children)\n  setupChildrenAndParents({tree})\n  setupSpouses({tree, node_separation})\n  nodePositioning({tree, is_vertical})\n\n  const dim = calculateTreeDim(tree, node_separation, level_separation, is_vertical)\n\n  return {data: tree, data_stash, dim}\n\n  function calculateTreePositions(datum, rt, is_ancestry) {\n    const hierarchyGetter = rt === \"children\" ? hierarchyGetterChildren : hierarchyGetterParents,\n      d3_tree = d3.tree().nodeSize([node_separation, level_separation]).separation(separation),\n      root = d3.hierarchy(datum, hierarchyGetter);\n    d3_tree(root);\n    return root.descendants()\n\n    function separation(a, b) {\n      let offset = 1;\n      if (!is_ancestry) {\n        if (!sameParent(a, b)) offset+=.25\n        if (someSpouses(a,b)) offset+=offsetOnPartners(a,b)\n        if (sameParent(a, b) && !sameBothParents(a,b)) offset+=.125\n      }\n      return offset\n    }\n\n    function hasCh(d) {return !!d.children}\n    function sameParent(a, b) {return a.parent == b.parent}\n    function sameBothParents(a, b) {return (a.data.rels.father === b.data.rels.father) && (a.data.rels.mother === b.data.rels.mother)}\n    function someChildren(a, b) {return hasCh(a) || hasCh(b)}\n    function hasSpouses(d) {return d.data.rels.spouses && d.data.rels.spouses.length > 0}\n    function someSpouses(a, b) {return hasSpouses(a) || hasSpouses(b)}\n\n    function hierarchyGetterChildren(d) {\n      return [...(d.rels.children || [])].map(id => data_stash.find(d => d.id === id))\n    }\n\n    function hierarchyGetterParents(d) {\n      return [d.rels.father, d.rels.mother]\n        .filter(d => d).map(id => data_stash.find(d => d.id === id))\n    }\n\n    function offsetOnPartners(a,b) {\n      return (Math.max((a.data.rels.spouses || []).length, (b.data.rels.spouses || []).length))*.5+.5\n    }\n  }\n\n  function levelOutEachSide(parents, children) {\n    const mid_diff = (parents[0].x - children[0].x) / 2\n    parents.forEach(d => d.x-=mid_diff)\n    children.forEach(d => d.x+=mid_diff)\n  }\n\n  function mergeSides(parents, children) {\n    parents.forEach(d => {d.is_ancestry = true})\n    parents.forEach(d => d.depth === 1 ? d.parent = children[0] : null)\n\n    return [...children, ...parents.slice(1)];\n  }\n  function nodePositioning({tree, is_vertical}) {\n    tree.forEach(d => {\n      d.y *= (d.is_ancestry ? -1 : 1)\n      if (!is_vertical) {\n        const d_x = d.x; d.x = d.y; d.y = d_x\n      }\n    })\n  }\n\n  function setupSpouses({tree, node_separation}) {\n    for (let i = tree.length; i--;) {\n      const d = tree[i]\n      if (!d.is_ancestry && d.data.rels.spouses && d.data.rels.spouses.length > 0){\n        const side = d.data.data.gender === \"M\" ? -1 : 1;  // female on right\n        d.x += d.data.rels.spouses.length/2*node_separation*side;\n        d.data.rels.spouses.forEach((sp_id, i) => {\n          const spouse = {data: data_stash.find(d0 => d0.id === sp_id), added: true}\n\n          spouse.x = d.x-(node_separation*(i+1))*side;\n          spouse.y = d.y\n          spouse.sx = i > 0 ? spouse.x : spouse.x + (node_separation/2)*side\n          spouse.depth = d.depth;\n          spouse.spouse = d;\n          if (!d.spouses) d.spouses = []\n          d.spouses.push(spouse)\n          tree.push(spouse)\n\n          tree.forEach(d0 => (\n            (d0.data.rels.father === d.data.id && d0.data.rels.mother === spouse.data.id) ||\n            (d0.data.rels.mother === d.data.id && d0.data.rels.father === spouse.data.id)\n            ) ? d0.psx = spouse.sx : null\n          )\n        })\n      }\n      if (d.parents && d.parents.length === 2) {\n        const p1 = d.parents[0],\n          p2 = d.parents[1],\n          midd = p1.x - (p1.x - p2.x)/2,\n          x = (d,sp) => midd + (node_separation/2)*(d.x < sp.x ? 1 : -1)\n\n        p2.x = x(p1, p2); p1.x = x(p2, p1)\n      }\n    }\n  }\n\n  function setupChildrenAndParents({tree}) {\n    tree.forEach(d0 => {\n      delete d0.children\n      tree.forEach(d1 => {\n        if (d1.parent === d0) {\n          if (d1.is_ancestry) {\n            if (!d0.parents) d0.parents = []\n            d0.parents.push(d1)\n          } else {\n            if (!d0.children) d0.children = []\n            d0.children.push(d1)\n          }\n        }\n      })\n    })\n  }\n\n  function calculateTreeDim(tree, node_separation, level_separation, is_vertical) {\n    if (!is_vertical) [node_separation, level_separation] = [level_separation, node_separation]\n    const w_extent = d3.extent(tree, d => d.x),\n      h_extent = d3.extent(tree, d => d.y)\n    return {\n      width: w_extent[1] - w_extent[0]+node_separation, height: h_extent[1] - h_extent[0]+level_separation, x_off: -w_extent[0]+node_separation/2, y_off: -h_extent[0]+level_separation/2\n    }\n  }\n\n  function createRelsToAdd(data) {\n    const to_add_spouses = [];\n    for (let i = 0; i < data.length; i++) {\n      const d = data[i];\n      if (d.rels.children && d.rels.children.length > 0) {\n        if (!d.rels.spouses) d.rels.spouses = []\n        const is_father = d.data.gender === \"M\"\n        let spouse\n\n        d.rels.children.forEach(d0 => {\n          const child = data.find(d1 => d1.id === d0)\n          if (child.rels[is_father ? 'father' : 'mother'] !== d.id) return\n          if (child.rels[!is_father ? 'father' : 'mother']) return\n          if (!spouse) {\n            spouse = createToAddSpouse(d)\n            d.rels.spouses.push(spouse.id)\n          }\n          spouse.rels.children.push(child.id)\n          child.rels[!is_father ? 'father' : 'mother'] = spouse.id\n        })\n      }\n    }\n    to_add_spouses.forEach(d => data.push(d))\n    return data\n\n    function createToAddSpouse(d) {\n      const spouse = createNewPerson({\n        data: {gender: d.data.gender === \"M\" ? \"F\" : \"M\"},\n        rels: {spouses: [d.id], children: []}\n      });\n      spouse.to_add = true;\n      to_add_spouses.push(spouse);\n      return spouse\n    }\n  }\n\n}\n","import d3 from \"../d3.js\"\n\nexport function setupSvg(svg, zoom_polite) {\n  setupZoom()\n\n  function setupZoom() {\n    if (svg.__zoom) return\n    const view = svg.querySelector('.view'),\n      zoom = d3.zoom().on(\"zoom\", zoomed)\n\n    d3.select(svg).call(zoom)\n    svg.__zoomObj = zoom\n\n    if (zoom_polite) zoom.filter(zoomFilter)\n\n    function zoomed(e) {\n      d3.select(view).attr(\"transform\", e.transform);\n    }\n\n    function zoomFilter(e) {\n      if (e.type === \"wheel\" && !e.ctrlKey) return false\n      else if (e.touches && e.touches.length < 2) return false\n      else return true\n    }\n  }\n}\n\nfunction positionTree({t, svg, transition_time=2000}) {\n  const zoom = svg.__zoomObj\n\n  // d3.select(svg).call(zoom.transform, d3.zoomIdentity.translate(x*k, y*k))\n\n  d3.select(svg).transition().duration(transition_time || 0).delay(transition_time ? 100 : 0)  // delay 100 because of weird error of undefined something in d3 zoom\n    .call(zoom.transform, d3.zoomIdentity.scale(t.k).translate(t.x, t.y))\n}\n\nexport function treeFit({svg, svg_dim, tree_dim, with_transition, transition_time}) {\n  const t = calculateTreeFit(svg_dim, tree_dim);\n  positionTree({t, svg, with_transition, transition_time})\n}\n\nexport function calculateTreeFit(svg_dim, tree_dim) {\n  let k = Math.min(svg_dim.width / tree_dim.width, svg_dim.height / tree_dim.height),\n    x = tree_dim.x_off + (svg_dim.width - tree_dim.width*k)/k/2,\n    y = tree_dim.y_off + (svg_dim.height - tree_dim.height*k)/k/2\n\n  if (k>1) {x*=k;y*=k;k=1;}\n  return {k,x,y}\n}\n\nexport function mainToMiddle({datum, svg, svg_dim, scale, transition_time}) {\n  const k = scale || 1, x = svg_dim.width/2-datum.x*k, y = svg_dim.height/2-datum.y,\n    t = {k, x: x/k, y: y/k}\n  positionTree({t, svg, with_transition: true, transition_time})\n}\n","import d3 from \"../../d3.js\";\n\nexport default function Link({d, entering, exiting}) {\n  const path = createPath(d, entering, exiting);\n\n  return {template: (`\n    <path d=\"${path}\" fill=\"none\" stroke=\"#fff\" />\n  `)}\n}\n\nexport function createPath(d, is_) {\n  const line = d3.line().curve(d3.curveMonotoneY),\n    lineCurve = d3.line().curve(d3.curveBasis),\n    path_data = is_ ? d._d() : d.d\n\n  if (!d.curve) return line(path_data)\n  else if (d.curve === true) return lineCurve(path_data)\n}","export function CardBody({d,card_dim,card_display}) {\n  return {template: (`\n    <g class=\"card-body\">\n      <rect width=\"${card_dim.w}\" height=\"${card_dim.h}\" class=\"card-body-rect\" />\n      <g transform=\"translate(${card_dim.text_x}, ${card_dim.text_y})\">\n        <text clip-path=\"url(#card_text_clip)\">\n          <tspan x=\"${0}\" dy=\"${14}\">${card_display[0](d.data)}</tspan>\n          <tspan x=\"${0}\" dy=\"${14}\" font-style = \"italic\">${card_display[1](d.data)}</tspan>\n          <tspan x=\"${0}\" dy=\"${14}\" font-size=\"10\">${card_display[2](d.data)}</tspan>\n        </text>\n        <rect width=\"${card_dim.w-card_dim.text_x-10}\" height=\"${card_dim.h-20}\" style=\"mask: url(#fade)\" class=\"text-overflow-mask\" /> \n      </g>\n    </g>\n  `)\n  }\n}\n\nexport function CardBodyAddNew({d,card_dim,card_add,label}) {\n  return {template: (`\n    <g class=\"card-body ${card_add ? 'card_add' : 'card-unknown'}\">\n      <rect class=\"card-body-rect\" width=\"${card_dim.w}\" height=\"${card_dim.h}\" fill=\"rgb(59, 85, 96)\" />\n      <text transform=\"translate(${card_dim.w/2}, ${card_dim.h/2})\" text-anchor=\"middle\" fill=\"#fff\">\n        <tspan font-size=\"18\" dy=\"${8}\">${label}</tspan>\n      </text>\n    </g>\n  `)\n  }\n}\n\nexport function CardBodyOutline({d,card_dim, is_new}) {\n  return {template: (`\n    <rect width=\"${card_dim.w}\" height=\"${card_dim.h}\" rx=\"4\" ry=\"4\" class=\"card-outline ${(d.data.main && !is_new) ? 'card-main-outline' : ''} ${is_new ? 'card-new-outline' : ''}\" />\n  `)\n  }\n}\n\nexport function PencilIcon({d,card_dim,x,y}) {\n  return ({template: (`\n    <g transform=\"translate(${x || card_dim.w-20},${y || card_dim.h-20})scale(.6)\" style=\"cursor: pointer\" class=\"card_edit pencil_icon\">\n      <circle fill=\"rgba(0,0,0,0)\" r=\"17\" cx=\"8.5\" cy=\"8.5\" />\n      <path fill=\"currentColor\" transform=\"translate(-1.5, -1.5)\"\n         d=\"M19.082,2.123L17.749,0.79c-1.052-1.052-2.766-1.054-3.819,0L1.925,12.794c-0.06,0.06-0.104,0.135-0.127,0.216\n          l-1.778,6.224c-0.05,0.175-0.001,0.363,0.127,0.491c0.095,0.095,0.223,0.146,0.354,0.146c0.046,0,0.092-0.006,0.137-0.02\n          l6.224-1.778c0.082-0.023,0.156-0.066,0.216-0.127L19.082,5.942C20.134,4.89,20.134,3.176,19.082,2.123z M3.076,13.057l9.428-9.428\n          l3.738,3.739l-9.428,9.428L3.076,13.057z M2.566,13.961l3.345,3.344l-4.683,1.339L2.566,13.961z M18.375,5.235L16.95,6.66\n          l-3.738-3.739l1.425-1.425c0.664-0.663,1.741-0.664,2.405,0l1.333,1.333C19.038,3.493,19.038,4.572,18.375,5.235z\"/>\n    </g>\n  `)})\n}\n\nexport function HideIcon({d,card_dim}) {\n  return ({template: (`\n    <g transform=\"translate(${card_dim.w-50},${card_dim.h-20})scale(.035)\" style=\"cursor: pointer\" class=\"card_hide_rels hide_rels_icon\">\n      <circle fill=\"rgba(0,0,0,0)\" r=\"256\" cx=\"256\" cy=\"256\" />\n      <g fill=\"currentColor\">\n        <path d=\"m34,256l26.2,26.2c108,108 283.7,108 391.7,0l26.1-26.2-26.2-26.2c-108-108-283.7-108-391.7,0l-26.1,\n          26.2zm222,126.2c-75.8,0-151.6-28.9-209.3-86.6l-32.9-32.9c-3.7-3.7-3.7-9.7 0-13.5l32.9-32.9c115.4-115.4 303.2-115.4 418.6,\n          0l32.9,32.9c3.7,3.7 3.7,9.7 0,13.5l-32.9,32.9c-57.7,57.7-133.5,86.6-209.3,86.6z\"/>\n        <path d=\"m256,183.5c-40,0-72.5,32.5-72.5,72.5s32.5,72.5 72.5,72.5c40,0 72.5-32.5 72.5-72.5s-32.5-72.5-72.5-72.5zm0,\n          164c-50.5,0-91.5-41.1-91.5-91.5 0-50.5 41.1-91.5 91.5-91.5s91.5,41.1 91.5,91.5c0,50.5-41,91.5-91.5,91.5z\"/>\n      </g>\n    </g>\n  `)})\n}\n\nexport function MiniTree({d,card_dim}) {\n  return ({template: (`\n    <g class=\"card_family_tree\" style=\"cursor: pointer\">\n      <rect x=\"-31\" y=\"-25\" width=\"72\" height=\"15\" fill=\"rgba(0,0,0,0)\"></rect>\n      <g transform=\"translate(${card_dim.w*.8},6)scale(.9)\">\n        <rect x=\"-31\" y=\"-25\" width=\"72\" height=\"15\" fill=\"rgba(0,0,0,0)\"></rect>\n        <line y2=\"-17.5\" stroke=\"#fff\" />\n        <line x1=\"-20\" x2=\"20\" y1=\"-17.5\" y2=\"-17.5\" stroke=\"#fff\" />\n        <rect x=\"-31\" y=\"-25\" width=\"25\" height=\"15\" rx=\"5\" ry=\"5\" class=\"card-male\" />\n        <rect x=\"6\" y=\"-25\" width=\"25\" height=\"15\" rx=\"5\" ry=\"5\" class=\"card-female\" />\n      </g>\n    </g>\n  `)})\n}\n\nexport function PlusIcon({d,card_dim,x,y}) {\n  return ({template: (`\n    <g class=\"card_add_relative\">\n      <g transform=\"translate(${x || card_dim.w/2},${y || card_dim.h})scale(.13)\">\n        <circle r=\"80\" cx=\"40\" cy=\"40\" fill=\"rgba(0,0,0,0)\" />\n        <g transform=\"translate(-10, -8)\">\n          <line\n            x1=\"10\" x2=\"90\" y1=\"50\" y2=\"50\"\n            stroke=\"currentColor\" stroke-width=\"15\" stroke-linecap=\"round\"\n          />\n          <line\n            x1=\"50\" x2=\"50\" y1=\"10\" y2=\"90\"\n            stroke=\"currentColor\" stroke-width=\"15\" stroke-linecap=\"round\"\n          />\n        </g>\n      </g>\n    </g>\n  `)})\n}\n\nexport function LinkBreakIcon({x,y,rt,closed}) {\n  return ({template: (`\n    <g style=\"\n          transform: translate(-12.2px, -.5px);\n          cursor: pointer;\n        \" \n        fill=\"currentColor\" class=\"card_break_link${closed ? ' closed' : ''}\"\n      >\n      <g style=\"transform: translate(${x}px,${y}px)scale(.02)rotate(${rt+'deg'})\">\n        <rect width=\"1000\" height=\"700\" y=\"150\" style=\"opacity: 0\" />\n        <g class=\"link_upper\">\n          <g>\n            <path d=\"M616.3,426.4c19,4.5,38.1-7.4,42.6-26.4c4.4-19-7.4-38-26.5-42.5L522.5,332c-18,11.1-53.9,33.4-53.9,33.4l80.4,18.6c-7.8,4.9-19.5,12.1-31.3,19.4L616.3,426.4L616.3,426.4z\"/>\n            <path d=\"M727.4,244.2c-50.2-11.6-100.3,3.3-135.7,35.4c28.6,22.6,64.5,30.2,116.4,51.3l141,32.6c23.9,5.6,56.6,47.2,51.1,71l-4.1,17c-5.6,23.7-47.3,56.4-71.2,51l-143.4-33.2c-66.8-8.6-104.1-16.6-132.9-7.5c17.4,44.9,55.9,80.8,106.5,92.4L800.9,588c81.3,18.8,162.3-31.5,181.2-112.4l4-17c18.8-81.1-31.7-161.8-112.9-180.6L727.4,244.2z\"/>\n          </g>\n        </g>\n        <g class=\"link_lower\">\n          <path d=\"M421.2,384.9l-128,127.6c-13.9,13.8-13.9,36.2,0,50s36.3,13.8,50.2,0.1l136.2-135.8v-36.7l-58.4,58.1V384.9L421.2,384.9z\"/>\n          <path d=\"M204.6,742.8c-17.4,17.3-63.3,17.2-80.6,0.1l-12.3-12.3c-17.3-17.3,0.6-81.2,17.9-98.5l100.2-99.9c12.5-14.9,45.8-40.8,66.1-103.7c-47.7-9.4-98.9,4.2-135.8,40.9L54.2,575c-58.9,58.8-58.9,154,0,212.8L66.6,800c58.9,58.8,154.5,58.8,213.4,0l105.8-105.6c38.4-38.3,51.3-91.9,39.7-141c-44,22.7-89,62.3-116,84.8L204.6,742.8z\"/>\n        </g>\n        <g class=\"link_particles\">\n          <path d=\"M351.9,248.4l-26.5,63.4l80.6,30.1L351.9,248.4z\"/>\n          <path d=\"M529.3,208l-43,26.6l35.4,52.3L529.3,208z\"/>\n          <path d=\"M426.6,158.8l-44-2.9l61.7,134.6L426.6,158.8z\"/>\n        </g>\n      </g>\n    </g>\n  `)})\n}\n\nexport function LinkBreakIconWrapper({d,card_dim}) {\n  let g = \"\",\n    r = d.data.rels, _r = d.data._rels || {},\n    closed = d.data.hide_rels,\n    areParents = r => r.father || r.mother,\n    areChildren = r => r.children && r.children.length > 0\n  if ((d.is_ancestry || d.data.main) && (areParents(r) || areParents(_r))) {g+=LinkBreakIcon({x:card_dim.w/2,y:0, rt: -45, closed}).template}\n  if (!d.is_ancestry && d.added) {\n    const sp = d.spouse, sp_r = sp.data.rels, _sp_r = sp.data._rels || {};\n    if ((areChildren(r) || areChildren(_r)) && (areChildren(sp_r) || areChildren(_sp_r))) {\n      g+=LinkBreakIcon({x:d.sx - d.x + card_dim.w/2 +24.4,y: (d.x !== d.sx ? card_dim.h/2 : card_dim.h)+1, rt: 135, closed}).template\n    }\n  }\n  return g\n}\n\nexport function CardImage({d, image, card_dim, maleIcon, femaleIcon}) {\n  return ({template: (`\n    <g style=\"transform: translate(${card_dim.img_x}px,${card_dim.img_y}px);\" class=\"card_image\" clip-path=\"url(#card_image_clip)\">\n      ${image \n        ? `<image href=\"${image}\" height=\"${card_dim.img_h}\" width=\"${card_dim.img_w}\" preserveAspectRatio=\"xMidYMin slice\" />`\n        : (d.data.data.gender === \"F\" && !!femaleIcon) ? femaleIcon({card_dim}) \n        : (d.data.data.gender === \"M\" && !!maleIcon) ? maleIcon({card_dim}) \n        : GenderlessIcon()\n      }      \n    </g>\n  `)})\n\n  function GenderlessIcon() {\n    return (`\n      <g class=\"genderless-icon\">\n        <rect height=\"${card_dim.img_h}\" width=\"${card_dim.img_w}\" fill=\"rgb(59, 85, 96)\" />\n        <g transform=\"scale(${card_dim.img_w*0.001616})\">\n         <path transform=\"translate(50,40)\" fill=\"lightgrey\" d=\"M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 \n            64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 \n            0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z\" />\n        </g>\n      </g>\n    `)\n  }\n}\n","export default function CalculateTree({datum, data_stash, card_dim, labels}) {\n  const sx = card_dim.w+40, y = card_dim.h+50,\n    lbls = labels || {}\n  datum = datum ? datum : {id: \"0\", data: {fn: \"FN\", ln: \"LN\", gender: \"M\"}}\n  const data = [\n    {x: 0, y: 0, data: datum},\n    {x: -100, y: -y, data: {rel_type: 'father', data: {label: lbls.father || \"Add father\", gender: \"M\"}}},\n    {x: 100, y: -y, data: {rel_type: 'mother', data: {label: lbls.mother || \"Add mother\", gender: \"F\"}}},\n\n    {x: sx, y: 0, data: {rel_type: 'spouse', data: {label: lbls.spouse || \"Add spouse\", gender: \"F\"}}},\n\n    {x: -100, y: y, data: {rel_type: 'son', data: {label: lbls.son || \"Add son\", gender: \"M\"}}},\n    {x: 100, y: y, data: {rel_type: 'daughter', data: {label: lbls.daughter || \"Add daughter\", gender: \"F\"}}},\n  ].filter(d => shouldAddRel(d.data.rel_type))\n\n  function shouldAddRel(rel_type) {\n    if (rel_type === 'father') return !datum.rels.father || data_stash.find(d => d.id === datum.rels.father).to_add\n    else if (rel_type === 'mother') return !datum.rels.mother || data_stash.find(d => d.id === datum.rels.mother).to_add\n    else return true\n  }\n\n  return {data}\n}\n","import {\n  addNewPerson,\n  createNewPersonWithGenderFromRel,\n  handleRelsOfNewDatum,\n} from \"../handlers/newPerson.js\"\n\nexport default function View(tree, {store, data_stash, cont, datum, card_dim, cardEditForm, scale}) {\n  const svg_dim = cont.getBoundingClientRect(),\n    tree_fit = calculateTreeFit(svg_dim),\n    mounted = (node) => {\n      addEventListeners(node)\n    }\n\n  return {\n    template: (`\n      <svg id=\"family-tree-svg\" style=\"width: 100%; height: 100%\">\n        <rect width=\"${svg_dim.width}\" height=\"${svg_dim.height}\" fill=\"transparent\" />\n        <g class=\"view\">\n          <g transform=\"translate(${tree_fit.x}, ${tree_fit.y})scale(${tree_fit.k})\">\n            ${tree.data.slice(1).map((d, i) => Link({d, is_vertical: ![\"spouse\"].includes(d.data.rel_type)}).template)}\n            ${tree.data.slice(1).map((d, i) => Card({d}).template)}\n          </g>\n        </g>\n      </svg>\n    `),\n    mounted\n  }\n\n  function calculateTreeFit(svg_dim) {\n    const k = scale || 1;\n    return {k, x:svg_dim.width/2, y: svg_dim.height/2}\n  }\n\n  function Card({d, is_main}) {\n    const [w, h] = is_main ? [160, 60] : [160, 40],\n      pos = {x: d.x, y: d.y}\n\n    return {template: (`\n      <g transform=\"translate(${pos.x}, ${pos.y})\" class=\"card\" data-rel_type=\"${d.data.rel_type}\" style=\"cursor: pointer\">\n        <g transform=\"translate(${-w / 2}, ${-h / 2})\">\n          ${CardBody({d,w,h}).template}\n        </g>\n      </g>\n    `)\n    }\n\n    function CardBody({d,w,h}) {\n      const color_class = d.data.data.gender === 'M' ? 'card-male' : d.data.data.gender === 'F' ? 'card-female' : 'card-genderless'\n      return {template: (`\n        <g>\n          <rect width=\"${w}\" height=\"${h}\" fill=\"#fff\" rx=\"${10}\" ${d.data.main ? 'stroke=\"#000\"' : ''} class=\"${color_class}\" />\n          <text transform=\"translate(${0}, ${h / 4})\">\n            <tspan x=\"${10}\" dy=\"${14}\">${d.data.data.label}</tspan>\n          </text>\n        </g>\n      `)\n      }\n    }\n  }\n\n  function Link({d, is_vertical}) {\n    return {template: (`\n      <path d=\"${createPath(d)}\" fill=\"none\" stroke=\"#fff\" />\n    `)}\n\n    function createPath() {\n      const {w,h} = card_dim;\n      let parent = (is_vertical && d.y < 0)\n        ? {x: 0, y: -h/2}\n        : (is_vertical && d.y > 0)\n        ? {x: 0, y: h/2}\n        : (!is_vertical && d.x < 0)\n        ? {x: -w/2, y: 0}\n        : (!is_vertical && d.x > 0)\n        ? {x: w/2, y: 0}\n        : {x: 0, y: 0}\n\n\n      if (is_vertical) {\n        return (\n          \"M\" + d.x + \",\" + d.y\n          + \"C\" + (d.x) + \",\" + (d.y + (d.y < 0 ? 50 : -50))\n          + \" \" + (parent.x) + \",\" + (parent.y + (d.y < 0 ? -50 : 50))\n          + \" \" + parent.x + \",\" + parent.y\n        )\n      } else {\n        const s = d.x > 0 ? +1 : -1;\n        return (\n          \"M\" + d.x + \",\" + d.y\n          + \"C\" + (parent.x + 50*s) + \",\" + d.y\n          + \" \" + (parent.x + 150*s) + \",\" + parent.y\n          + \" \" + parent.x + \",\" + parent.y\n        )\n      }\n    }\n  }\n\n  function addEventListeners(view) {\n    view.addEventListener(\"click\", e => {\n      const node = e.target\n      handleCardClick(node) || view.remove()\n    })\n\n    function handleCardClick(node) {\n      if (!node.closest('.card')) return\n      const card = node.closest('.card'),\n        rel_type = card.getAttribute(\"data-rel_type\"),\n        rel_datum = datum,\n        new_datum = createNewPersonWithGenderFromRel({rel_datum, rel_type}),\n        postSubmit = () => {\n          view.remove();\n          addNewPerson({data_stash, datum: new_datum})\n          handleRelsOfNewDatum({datum: new_datum, data_stash, rel_datum, rel_type})\n          store.update.tree();\n        }\n      cardEditForm({datum: new_datum, rel_datum, rel_type, postSubmit, store})\n      return true\n    }\n  }\n\n}\n","import {toggleAllRels, toggleRels} from \"../CalculateTree/CalculateTree.handlers.js\"\nimport AddRelativeTree from \"../AddRelativeTree/AddRelativeTree.js\"\nimport {deletePerson, moveToAddToAdded} from \"./general.js\"\n\nexport function cardChangeMain(store, {card, d}) {\n  toggleAllRels(store.getTree().data, false)\n  store.update.mainId(d.data.id)\n  store.update.tree({tree_position: 'inherit'})\n  return true\n}\n\nexport function cardEdit(store, {card, d, cardEditForm}) {\n  const datum = d.data,\n    postSubmit = (props) => {\n      if (datum.to_add) moveToAddToAdded(datum, store.getData())\n      if (props && props.delete) {\n        if (datum.main) store.update.mainId(null)\n        deletePerson(datum, store.getData())\n      }\n      store.update.tree()\n    }\n  cardEditForm({datum, postSubmit, store})\n}\n\nexport function cardShowHideRels(store, {card, d}) {\n  d.data.hide_rels = !d.data.hide_rels\n  toggleRels(d, d.data.hide_rels)\n  store.update.tree({tree_position: 'inherit'})\n}","import {\n  CardBody,\n  CardBodyAddNew,\n  CardBodyOutline,\n  CardImage,\n  LinkBreakIconWrapper,\n  MiniTree, PencilIcon,\n  PlusIcon\n} from \"./Card.Elements.js\"\nimport {cardChangeMain, cardEdit, cardShowHideRels} from \"../../handlers/cardMethods.js\"\nimport {isAllRelativeDisplayed} from \"../../handlers/general.js\"\n\nexport function Card(props) {\n  props = setupProps(props);\n  const store = props.store;\n  setupSvgDefs()\n\n  return function ({node, d}) {\n    const el = document.createElementNS(\"http://www.w3.org/2000/svg\", 'g'),\n      gender_class = d.data.data.gender === 'M' ? 'card-male' : d.data.data.gender === 'F' ? 'card-female' : 'card-genderless',\n      card_dim = props.card_dim,\n      show_mini_tree = !isAllRelativeDisplayed(d, store.state.tree.data),\n      unknown_lbl = props.cardEditForm ? 'ADD' : 'UNKNOWN',\n\n      mini_tree = () => !d.data.to_add && show_mini_tree ? MiniTree({d,card_dim}).template : '',\n      card_body_outline = () => CardBodyOutline({d,card_dim,is_new:d.data.to_add}).template,\n      card_body = () => !d.data.to_add ? CardBody({d,card_dim, card_display: props.card_display}).template : CardBodyAddNew({d,card_dim, card_add: props.cardEditForm, label: unknown_lbl}).template,\n      card_image = () => !d.data.to_add ? CardImage({d, image: d.data.data.avatar || null, card_dim, maleIcon: null, femaleIcon: null}).template : '',\n      edit_icon = () => !d.data.to_add && props.cardEditForm ? PencilIcon({card_dim, x: card_dim.w-46, y: card_dim.h-20}).template : '',\n      add_icon = () => !d.data.to_add && props.cardEditForm ? PlusIcon({card_dim, x: card_dim.w-26, y: card_dim.h-20}).template : '',\n      link_break_icon = () => LinkBreakIconWrapper({d,card_dim})\n\n    el.innerHTML = (`\n      <g class=\"card ${gender_class}\" data-id=\"${d.data.id}\" data-cy=\"card\">\n        <g transform=\"translate(${-card_dim.w / 2}, ${-card_dim.h / 2})\">\n          ${props.mini_tree ? mini_tree() : ''}\n          ${card_body_outline()}\n          <g clip-path=\"url(#card_clip)\">\n            ${card_body()}\n            ${card_image()}\n            ${edit_icon()}\n            ${add_icon()}\n          </g>\n          ${props.link_break ? link_break_icon() : ''}\n        </g>\n      </g>\n    `)\n    setupListeners(el, d, store);\n\n    return el\n  }\n\n  function setupListeners(el, d, store) {\n    let p;\n\n    p = el.querySelector(\".card\")\n    if (p) p.addEventListener(\"click\", (e) => {e.stopPropagation();cardChangeMain(store, {card:el, d})})\n\n    p = el.querySelector(\".card_edit\")\n    if (p && props.cardEditForm) p.addEventListener(\"click\", (e) => {e.stopPropagation();cardEdit(store, {card:el, d, cardEditForm: props.cardEditForm})})\n\n    p = el.querySelector(\".card_add\")\n    if (p && props.cardEditForm) p.addEventListener(\"click\", (e) => {e.stopPropagation();cardEdit(store, {card:el, d, cardEditForm: props.cardEditForm})})\n\n    p = el.querySelector(\".card_add_relative\")\n    if (p) p.addEventListener(\"click\", (e) => {e.stopPropagation();props.addRelative({d})})\n\n    p = el.querySelector(\".card_family_tree\")\n    if (p) p.addEventListener(\"click\", (e) => {e.stopPropagation();cardChangeMain(store, {card:el, d})})\n\n    p = el.querySelector(\".card_break_link\")\n    if (p) p.addEventListener(\"click\", (e) => {e.stopPropagation();cardShowHideRels(store, {card:el, d})})\n  }\n\n  function setupSvgDefs() {\n    if (props.svg.querySelector(\"defs#f3CardDef\")) return\n    const card_dim = props.card_dim\n    props.svg.insertAdjacentHTML('afterbegin', (`\n      <defs id=\"f3CardDef\">\n        <linearGradient id=\"fadeGrad\">\n          <stop offset=\"0.9\" stop-color=\"white\" stop-opacity=\"0\"/>\n          <stop offset=\".91\" stop-color=\"white\" stop-opacity=\".5\"/>\n          <stop offset=\"1\" stop-color=\"white\" stop-opacity=\"1\"/>\n        </linearGradient>\n        <mask id=\"fade\" maskContentUnits=\"objectBoundingBox\"><rect width=\"1\" height=\"1\" fill=\"url(#fadeGrad)\"/></mask>\n        <clipPath id=\"card_clip\"><path d=\"${curvedRectPath({w:card_dim.w, h:card_dim.h}, 5)}\"></clipPath>\n        <clipPath id=\"card_text_clip\"><rect width=\"${card_dim.w-card_dim.text_x-10}\" height=\"${card_dim.h-10}\"></rect></clipPath>\n        <clipPath id=\"card_image_clip\"><path d=\"M0,0 Q 0,0 0,0 H${card_dim.img_w} V${card_dim.img_h} H0 Q 0,${card_dim.img_h} 0,${card_dim.img_h} z\"></clipPath>\n        <clipPath id=\"card_image_clip_curved\"><path d=\"${curvedRectPath({w: card_dim.img_w, h:card_dim.img_h}, 5, ['rx', 'ry'])}\"></clipPath>\n      </defs>\n    `))\n\n    function curvedRectPath(dim, curve, no_curve_corners) {\n      const {w,h} = dim,\n        c = curve,\n        ncc = no_curve_corners || [],\n        ncc_check = (corner) => ncc.includes(corner),\n        lx = ncc_check('lx') ? `M0,0` : `M0,${c} Q 0,0 5,0`,\n        rx = ncc_check('rx') ? `H${w}` : `H${w-c} Q ${w},0 ${w},5`,\n        ry = ncc_check('ry') ? `V${h}` : `V${h-c} Q ${w},${h} ${w-c},${h}`,\n        ly = ncc_check('ly') ? `H0` : `H${c} Q 0,${h} 0,${h-c}`\n\n      return (`${lx} ${rx} ${ry} ${ly} z`)\n    }\n  }\n\n  function setupProps(props) {\n    const default_props = {\n      mini_tree: true,\n      link_break: true,\n      card_dim: {w:220,h:70,text_x:75,text_y:15,img_w:60,img_h:60,img_x:5,img_y:5}\n    }\n    if (!props) props = {}\n    for (const k in default_props) {\n      if (typeof props[k] === 'undefined') props[k] = default_props[k]\n    }\n    return props\n  }\n}\n","import {toggleAllRels} from \"../CalculateTree/CalculateTree.handlers.js\"\nimport AddRelativeTree from \"./AddRelativeTree.js\"\n\nexport function AddRelative({store, cont, card_dim, cardEditForm, labels}) {\n  return function ({d, scale}) {\n    const transition_time = 1000\n\n    if (!scale && window.innerWidth < 650) scale = window.innerWidth / 650\n    toggleAllRels(store.getTree().data, false)\n    store.update.mainId(d.data.id);\n    store.update.tree({tree_position: 'main_to_middle', transition_time, scale})\n    const props = {\n      store,\n      data_stash: store.getData(),\n      cont,\n      datum: d.data,\n      transition_time,\n      scale,\n      card_dim,\n      cardEditForm,\n      labels\n    }\n    AddRelativeTree(props)\n  }\n}\n","import d3 from \"../d3.js\"\nimport CalculateTree from \"./AddRelativeTree.CalculateTree.js\"\nimport View from \"./AddRelativeTree.View.js\"\n\nexport default function AddRelativeTree(props) {\n  const tree = CalculateTree(props),\n    view = View(tree, props)\n\n  const div_add_relative = document.createElement(\"div\")\n  div_add_relative.style.cssText = \"width: 100%; height: 100%; position: absolute; top: 0; left: 0;background-color: rgba(0,0,0,.3);opacity: 0\"\n  div_add_relative.innerHTML = view.template\n\n  props.cont.appendChild(div_add_relative)\n  view.mounted(div_add_relative)\n  d3.select(div_add_relative).transition().duration(props.transition_time).delay(props.transition_time/4).style(\"opacity\", 1)\n}\n","import CalculateTree from \"./CalculateTree/CalculateTree.js\"\nimport d3AnimationView from \"./view/View.d3Animation.js\"\nimport createStore from \"./createStore.js\"\nimport * as handlers from './handlers.js'\nimport * as elements from './elements.js'\n\nexport default {\n  CalculateTree,\n  createStore,\n  d3AnimationView,\n  handlers,\n  elements\n}","import CalculateTree from \"./CalculateTree/CalculateTree.js\"\nimport {createTreeDataWithMainNode} from \"./handlers/newPerson.js\"\n\nexport default function createStore(initial_state) {\n  let onUpdate;\n  const state = initial_state,\n    update = {\n      tree: (props) => {\n        state.tree = calcTree();\n        if (onUpdate) onUpdate(props)\n      },\n      mainId: main_id => state.main_id = main_id,\n      data: data => state.data = data\n    },\n    getData = () => state.data,\n    getTree = () => state.tree,\n    setOnUpdate = (f) => onUpdate = f,\n    methods = {}\n\n  return {state, update, getData, getTree, setOnUpdate, methods}\n\n\n  function calcTree() {\n    return CalculateTree({\n      data_stash: state.data, main_id: state.main_id,\n      node_separation: state.node_separation, level_separation: state.level_separation\n    })\n  }\n}","import d3 from \"../d3.js\"\n\nimport {mainToMiddle, setupSvg, treeFit} from \"./View.handlers.js\"\nimport {createPath} from \"./elements/Link.js\"\nimport {createLinks} from \"../CalculateTree/createLinks.js\"\nimport {Card as CardDefault} from \"./elements/Card.js\"\nimport {calculateEnterAndExitPositions} from \"../CalculateTree/CalculateTree.handlers.js\"\n\nexport default function d3AnimationView({store, cont, Card}) {\n  const svg = createSvg();\n  setupSvg(svg, store.state.zoom_polite);\n\n  return {update: updateView, svg, setCard: card => Card = card}\n\n  function updateView(props) {\n    if (!props) props = {}\n    const tree = store.state.tree,\n      view = d3.select(svg).select(\".view\"),\n      tree_position = props.tree_position || 'fit',\n      transition_time = props.hasOwnProperty('transition_time') ? props.transition_time : 1000;\n\n    updateCards();\n    updateLinks();\n    if (props.initial) treeFit({svg, svg_dim: svg.getBoundingClientRect(), tree_dim: tree.dim, transition_time: 0})\n    else if (tree_position === 'fit') treeFit({svg, svg_dim: svg.getBoundingClientRect(), tree_dim: tree.dim, transition_time})\n    else if (tree_position === 'main_to_middle') mainToMiddle({datum: tree.data[0], svg, svg_dim: svg.getBoundingClientRect(), scale: props.scale, transition_time})\n    else if (tree_position === 'inherit') {}\n\n    return true\n\n    function updateLinks() {\n      const links_data = tree.data.reduce((acc, d) => acc.concat(createLinks({d, tree:tree.data})), []),\n        link = view.select(\".links_view\").selectAll(\"path.link\").data(links_data, d => d.id),\n        link_exit = link.exit(),\n        link_enter = link.enter().append(\"path\").attr(\"class\", \"link\"),\n        link_update = link_enter.merge(link)\n\n      link_exit.each(linkExit)\n      link_enter.each(linkEnter)\n      link_update.each(linkUpdate)\n\n      function linkEnter(d) {\n        d3.select(this).attr(\"fill\", \"none\").attr(\"stroke\", \"#fff\").style(\"opacity\", 0)\n          .attr(\"d\", createPath(d, true))\n      }\n\n      function linkUpdate(d) {\n        const path = d3.select(this);\n        const delay = calculateDelay(d)\n        path.transition('path').duration(transition_time).delay(delay).attr(\"d\", createPath(d)).style(\"opacity\", 1)\n      }\n\n      function linkExit(d) {\n        const path = d3.select(this);\n        path.transition('op').duration(800).style(\"opacity\", 0)\n        path.transition('path').duration(transition_time).attr(\"d\", createPath(d, true))\n          .on(\"end\", () => path.remove())\n      }\n\n    }\n\n    function updateCards() {\n      const card = view.select(\".cards_view\").selectAll(\"g.card_cont\").data(tree.data, d => d.data.id),\n        card_exit = card.exit(),\n        card_enter = card.enter().append(\"g\").attr(\"class\", \"card_cont\"),\n        card_update = card_enter.merge(card)\n\n      card_exit.each(d => calculateEnterAndExitPositions(d, false, true))\n      card_enter.each(d => calculateEnterAndExitPositions(d, true, false))\n\n      card_exit.each(cardExit)\n      card.each(cardUpdateNoEnter)\n      card_enter.each(cardEnter)\n      card_update.each(cardUpdate)\n\n      function cardEnter(d) {\n        d3.select(this)\n          .attr(\"transform\", `translate(${d._x}, ${d._y})`)\n          .style(\"opacity\", 0)\n          .node().appendChild(CardElement(this, d))\n      }\n\n      function cardUpdateNoEnter(d) {}\n\n      function cardUpdate(d) {\n        this.innerHTML = \"\"\n        this.appendChild(CardElement(this, d))\n        const delay = calculateDelay(d);\n        d3.select(this).transition().duration(transition_time).delay(delay).attr(\"transform\", `translate(${d.x}, ${d.y})`).style(\"opacity\", 1)\n      }\n\n      function cardExit(d) {\n        const g = d3.select(this)\n        g.transition().duration(transition_time).style(\"opacity\", 0).attr(\"transform\", `translate(${d._x}, ${d._y})`)\n          .on(\"end\", () => g.remove())\n      }\n\n      function CardElement(node, d) {\n        if (Card) return Card({node, d})\n        else return CardDefault({store, svg})({node, d})\n      }\n    }\n\n    function calculateDelay(d) {\n      if (!props.initial) return 0\n      const delay_level = 100,\n        ancestry_levels = Math.max(...tree.data.map(d=>d.is_ancestry ? d.depth : 0))\n      let delay = d.depth*delay_level;\n      if ((d.depth !== 0 || !!d.spouse) && !d.is_ancestry) {\n        delay+=(ancestry_levels)*delay_level  // after ancestry\n        if (d.spouse) delay+=delay_level  // spouse after bloodline\n        delay+=(d.depth)*delay_level  // double the delay for each level because of additional spouse delay\n      }\n      return delay\n    }\n\n  }\n\n  function createSvg() {\n    const svg_dim = cont.getBoundingClientRect(),\n      svg_html = (`\n        <svg class=\"main_svg\">\n          <rect width=\"${svg_dim.width}\" height=\"${svg_dim.height}\" fill=\"transparent\" />\n          <g class=\"view\">\n            <g class=\"links_view\"></g>\n            <g class=\"cards_view\"></g>\n          </g>\n          <g style=\"transform: translate(100%, 100%)\">\n            <g class=\"fit_screen_icon cursor-pointer\" style=\"transform: translate(-50px, -50px); display: none\">\n              <rect width=\"27\" height=\"27\" stroke-dasharray=\"${27/2}\" stroke-dashoffset=\"${27/4}\" \n                style=\"stroke:#fff;stroke-width:4px;fill:transparent;\"/>\n              <circle r=\"5\" cx=\"${27/2}\" cy=\"${27/2}\" style=\"fill:#fff\" />          \n            </g>\n          </g>\n        </svg>\n      `)\n    const fake_cont = document.createElement(\"div\")\n    fake_cont.innerHTML = svg_html\n    const svg = fake_cont.firstElementChild\n    cont.innerHTML = \"\"\n    cont.appendChild(svg)\n\n    return svg\n  }\n}","export function createLinks({d, tree, is_vertical}) {\n  const links = [];\n\n  if (d.data.rels.spouses && d.data.rels.spouses.length > 0) handleSpouse({d})\n  handleAncestrySide({d})\n  handleProgenySide({d})\n\n  return links;\n\n  function handleAncestrySide({d}) {\n    if (!d.parents || d.parents.length !== 2) return\n    const p1 = d.parents[0], p2 = d.parents[1]\n\n    const p = {x: getMid(p1, p2, 'x'), y: getMid(p1, p2, 'y')}\n\n    links.push({\n      d: Link(d, p),\n      _d: () => {\n        const _d = {x: d.x, y: d.y},\n          _p = {x: d.x, y: d.y}\n        return Link(_d, _p)\n      },\n      curve: true, id: linkId(d, d.parents[0], d.parents[1]), depth: d.depth+1, is_ancestry: true\n    })\n  }\n\n\n  function handleProgenySide({d}) {\n    if (!d.children || d.children.length === 0) return\n\n    d.children.forEach((child, i) => {\n      const other_parent = otherParent(child, d, tree),\n        sx = other_parent.sx\n\n      links.push({\n        d: Link(child, {x: sx, y: d.y}),\n        _d: () => Link({x: sx, y: d.y}, {x: _or(child, 'x'), y: _or(child, 'y')}),\n        curve: true, id: linkId(child, d, other_parent), depth: d.depth+1\n      })\n    })\n  }\n\n\n  function handleSpouse({d}) {\n    d.data.rels.spouses.forEach(sp_id => {\n      const spouse = tree.find(d0 => d0.data.id === sp_id);\n      if (!spouse || d.spouse) return\n      links.push({\n        d: [[d.x, d.y], [spouse.x, spouse.y]],\n        _d: () => [\n          d.is_ancestry ? [_or(d, 'x')-.0001, _or(d, 'y')] : [d.x, d.y], // add -.0001 to line to have some length if d.x === spouse.x\n          d.is_ancestry ? [_or(spouse, 'x', true), _or(spouse, 'y')] : [d.x-.0001, d.y]\n        ],\n        curve: false, id: [d.data.id, spouse.data.id].join(\", \"), depth: d.depth, spouse: true, is_ancestry: spouse.is_ancestry\n      })\n    })\n  }\n\n  ///\n  function getMid(d1, d2, side, is_) {\n    if (is_) return _or(d1, side) - (_or(d1, side) - _or(d2, side))/2\n    else return d1[side] - (d1[side] - d2[side])/2\n  }\n\n  function _or(d, k) {\n   return d.hasOwnProperty('_'+k) ? d['_'+k] : d[k]\n  }\n\n  function Link(d, p) {\n    const hy = (d.y + (p.y - d.y) / 2)\n    return [\n      [d.x, d.y],\n      [d.x, hy],\n      [d.x, hy],\n      [p.x, hy],\n      [p.x, hy],\n      [p.x, p.y],\n    ]\n  }\n\n  function linkId(...args) {\n    return args.map(d => d.data.id).sort().join(\", \")  // make unique id\n  }\n\n  function otherParent(d, p1, data) {\n    return data.find(d0 => (d0.data.id !== p1.data.id) && ((d0.data.id === d.data.rels.mother) || (d0.data.id === d.data.rels.father)))\n  }\n}\n\n\n\n\n","import React from \"react\";\nimport f3 from \"./src/index.js\"; // npm i family-chart\nimport \"./family-chart.css\"; // create file 'family-chart.css' in same directory, copy/paste css from examples/create-tree\n\nexport default class FamilyTree extends React.Component {\n  cont = React.createRef();\n\n  componentDidMount() {\n    if (!this.cont.current) return;\n\n    const store = f3.createStore({\n        data: data(),\n        node_separation: 250,\n        level_separation: 150\n      }),\n      view = f3.d3AnimationView({\n        store,\n        cont: document.querySelector(\"#FamilyChart\")\n      }),\n      Card = f3.elements.Card({\n        store,\n        svg: view.svg,\n        card_dim: {\n          w: 220,\n          h: 70,\n          text_x: 75,\n          text_y: 15,\n          img_w: 60,\n          img_h: 60,\n          img_x: 5,\n          img_y: 5\n        },\n        card_display: [\n          (d) => `${d.data[\"first name\"] || \"\"} ${d.data[\"last name\"] || \"\"}`,\n          (function (d) { if (d.data[\"nee\"]){\n            return \"nee \" + d.data[\"nee\"];\n          }\n          else {\n            return \"\";\n          }\n          }),\n          (d) => `${d.data[\"birthday\"] || \"\"}`\n        ],\n        mini_tree: true,\n        link_break: false\n      });\n\n    view.setCard(Card);\n    store.setOnUpdate((props) => view.update(props || {}));\n    store.update.tree({ initial: true });\n\n    function data() {\n      return require('./data.json');\n    }\n  }\n\n  render() {\n    return <div className=\"f3\" id=\"FamilyChart\" ref={this.cont}></div>;\n  }\n}\n","import React from \"react\";\nimport FamilyChart from \"./FamilyChart\";\n\nexport default function App() {\n  return (\n    <div className=\"App\">\n      <FamilyChart />\n    </div>\n  );\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport App from \"./App\";\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  rootElement\n);\n"],"sourceRoot":""}